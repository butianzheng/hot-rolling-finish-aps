# 重构进度与 TODO（持续更新）

> 目标：把“前端重构方案”落到可执行的任务列表，并在每次任务结束后同步更新状态。
> 状态约定：`[x] 已完成` / `[ ] 待办`

最后更新：2026-01-29

---

## 进度总览（按阶段）

- [x] Phase 1 基础设施（路由/状态/类型/样式/骨架屏/错误边界/网络监听）
- [x] Phase 2 风险概览页（多维 KPI + 问题列表 + 抽屉下钻 + 跳转联动）
- [x] Phase 3 计划工作台（物料池 + 三视图 + 批量操作 + 一键优化 + 红线校验）
- [x] Phase 4 版本对比页（历史版本对比 + 策略草案对比）
- [x] Phase 5 数据导入 + 设置中心整合（页面整合完成，持续优化）
- [x] Phase 6 工作流引导与整体优化（引导/自定义策略/遥测/清理已落地）

---

## P0（必须：功能闭环/不破红线）

- [x] 新页面架构与路由（/overview /workbench /comparison /import /settings）
- [x] 顶部 Header：全局 KPI + 导入/重算状态提示 + 离线提示
- [x] 风险概览：多维 Tab + 问题列表 + 抽屉下钻 + 去工作台联动
- [x] 工作台：物料池支持“按紧急度分组”显示
- [x] 工作台：物料详情 Inspector 支持 deep-link（/workbench?material_id=...）
- [x] 策略草案：真 dry-run（不落库）生成多策略草案
- [x] 策略草案：发布草案生成正式版本，并记录 ActionLog
- [x] 草案对比 KPI：mature/immature、total_capacity_used_t、overflow_days（无需额外查库指标）
- [x] “变更明细”抽屉：moved/added/squeezed_out 列表 + 搜索/筛选
- [x] 物料解释：点击 material_id 打开物料弹窗，展示变更上下文 + 最近操作（30天）
- [x] 版本中文命名：发布草案/一键优化生成的新版本写入 config_snapshot_json（不改表结构）
- [x] 版本对比：config_snapshot_json 对比过滤 __meta_*（避免把“名称”当配置差异）
- [x] 挤出解释提示：基于 material_state（未适温/最早可排/冻结/锁定/紧急等），尽量不臆测
- [x] 操作日志查询优化：按 material_id 精准查询 + 启动时补齐 action_log 索引（best-effort）

---

## P1（重要：可解释性/性能/测试补齐）

- [x] 测试：补 `list_action_logs_by_material` 的 e2e/repo 覆盖（避免回归）
- [x] 挤出解释的“状态提示”进一步结构化（比如固定字段顺序/突出关键阻塞项）
- [x] 草案 diff 明细减少额外查库：后端在 diff_items 里直接带 material_state 关键 flags（可选）
- [x] Phase 6：工作流“下一步引导”（从风险问题 -> 工作台推荐操作 -> 版本对比 -> 发布）

---

## P2（增强：自定义策略/长期可维护）

- [x] 后端：`save_custom_strategy`（自定义策略持久化方案与校验）
- [x] 前端：设置中心增加“策略配置”入口（复制预设 -> 调参 -> 保存 -> 草案对比可选）
- [x] 后端排程：自定义策略参数真正生效（草案生成/发布支持 `custom:...`，参数下沉到等级内排序；不触碰冻结区/适温/产能硬约束）
- [x] 可选：前端日志上报/错误上报（替代仅 console）
- [x] 清理：逐步下线旧页面/旧路由（在确认新链路稳定后）
