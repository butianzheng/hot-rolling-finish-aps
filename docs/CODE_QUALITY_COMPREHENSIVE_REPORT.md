# çƒ­è½§ç²¾æ•´æ’äº§ç³»ç»Ÿ - ä»£ç è´¨é‡ç»¼åˆè¯„ä¼°æŠ¥å‘Š

> **ç”Ÿæˆæ—¥æœŸ**: 2026-01-29
> **é¡¹ç›®ç‰ˆæœ¬**: v0.3
> **æ‰«æèŒƒå›´**: å…¨æ ˆä»£ç åº“ï¼ˆå‰ç«¯ + åç«¯ + APIå±‚ï¼‰
> **è¯„ä¼°æ ‡å‡†**: ä»£ç è´¨é‡ã€æ¶æ„ä¸€è‡´æ€§ã€è€¦åˆåº¦ã€å¯ç»´æŠ¤æ€§

---

## ğŸ“‹ æ‰§è¡Œæ‘˜è¦

### é¡¹ç›®æ¦‚å†µ

- **å‰ç«¯**: 100ä¸ª TypeScript/TSX æ–‡ä»¶ï¼ŒåŸºäº React 18 + Zustand + Ant Design
- **åç«¯**: 113ä¸ª Rust æ–‡ä»¶ï¼ŒåŸºäº Tauri + SQLiteï¼Œå·¥ä¸šçº§å†³ç­–æ”¯æŒç³»ç»Ÿ
- **æ€»ä»£ç é‡**: çº¦67,000è¡Œä»£ç ï¼ˆ49,739è¡ŒRust + 17,000+è¡ŒTypeScriptï¼‰
- **æµ‹è¯•è¦†ç›–**: 39ä¸ªæµ‹è¯•æ–‡ä»¶ï¼Œ415ä¸ªå•å…ƒæµ‹è¯•

### æ€»ä½“è¯„åˆ†

| ç»´åº¦ | è¯„åˆ† | ç­‰çº§ |
|------|------|------|
| **å‰ç«¯ä»£ç è´¨é‡** | 5.6/10 | ä¸­ç­‰ |
| **åç«¯ä»£ç è´¨é‡** | 8.0/10 | ä¼˜ç§€ |
| **APIå±‚ä¸€è‡´æ€§** | 6.5/10 | è‰¯å¥½ |
| **æ¶æ„è®¾è®¡** | 7.5/10 | è‰¯å¥½ |
| **æ¨¡å—è€¦åˆåº¦** | 6.0/10 | ä¸­ç­‰ |
| **å¯ç»´æŠ¤æ€§** | 6.5/10 | è‰¯å¥½ |
| **å·¥ä¸šåˆè§„æ€§** | 9.0/10 | ä¼˜ç§€ |
| **ç»¼åˆè¯„åˆ†** | **7.0/10** | **è‰¯å¥½** |

### å…³é”®å‘ç°

âœ… **ä¼˜åŠ¿**ï¼š
- âœ“ åç«¯æ¶æ„æ¸…æ™°ï¼Œåˆ†å±‚æ˜ç¡®ï¼Œæ— å¾ªç¯ä¾èµ–
- âœ“ å·¥ä¸šçº¢çº¿å®Œæ•´å®ç°ï¼Œç¬¦åˆCLAUDE.mdè§„èŒƒ
- âœ“ é”™è¯¯å¤„ç†ä½“ç³»å®Œå–„ï¼Œå…·å¤‡å¯è¿½æº¯æ€§
- âœ“ æµ‹è¯•è¦†ç›–å……åˆ†ï¼ˆ415ä¸ªå•å…ƒæµ‹è¯•ï¼‰

âš ï¸ **å¾…æ”¹è¿›**ï¼š
- âœ— å‰ç«¯å­˜åœ¨å¤šä¸ª1000+è¡Œçš„å·¨å‹ç»„ä»¶
- âœ— åç«¯æœ‰90å¤„ä¸å®‰å…¨çš„`.lock().unwrap()`
- âœ— APIå±‚å­˜åœ¨6å¯¹é‡å¤çš„"Full"ç‰ˆæœ¬æ¥å£
- âœ— ç±»å‹å®‰å…¨ä¸è¶³ï¼Œå­˜åœ¨20+å¤„`any`ç±»å‹æ»¥ç”¨
- âœ— å‰ç«¯ç»„ä»¶é—´é«˜åº¦è€¦åˆï¼Œç¼ºå°‘åˆ†å±‚

---

## 1ï¸âƒ£ å‰ç«¯ä»£ç è´¨é‡åˆ†æ

### 1.1 ç»„ä»¶ç»“æ„è¯„ä¼°

#### ğŸ“Š ç»„ä»¶è§„æ¨¡ç»Ÿè®¡

| ç»„ä»¶ | è¡Œæ•° | çŠ¶æ€ | é—®é¢˜ |
|------|------|------|------|
| PlanManagement.tsx | 1,904 | ğŸ”´ ä¸¥é‡è¿‡å¤§ | æ‰¿è½½å¤ªå¤šèŒè´£ |
| StrategyDraftComparison.tsx | 1,710 | ğŸ”´ ä¸¥é‡è¿‡å¤§ | å¯¹æ¯”é€»è¾‘+UI+çŠ¶æ€ |
| DrilldownDrawer.tsx | 1,113 | ğŸŸ¡ è¿‡å¤§ | åµŒå¥—é€»è¾‘å¤æ‚ |
| MaterialManagement.tsx | 800+ | ğŸŸ¡ åå¤§ | 10+ä¸ªuseState |
| Dashboard.tsx | 400+ | ğŸŸ¢ å¯æ¥å— | ä½†å¯ä¼˜åŒ– |

**å…³é”®é—®é¢˜**ï¼š

```typescript
// âŒ PlanManagement.tsx èŒè´£è¿‡å¤š
- æ•°æ®åŠ è½½ (200è¡Œ)
- æ•°æ®è½¬æ¢ (400è¡Œ)
- ç‰ˆæœ¬å¯¹æ¯” (300è¡Œ)
- å¯¼å‡ºåŠŸèƒ½ (150è¡Œ)
- UIæ¸²æŸ“ (800è¡Œ)
- å¯¹è¯æ¡†ç®¡ç† (54è¡Œ)
```

**å»ºè®®**ï¼šå°†å¤§ç»„ä»¶åˆ†è§£ä¸º 5-8 ä¸ªå­ç»„ä»¶ï¼ŒæŒ‰èŒè´£åˆ†ç¦»ã€‚

#### ğŸ“ ç›®å½•ç»“æ„é—®é¢˜

å½“å‰ç»“æ„ï¼š
```
src/components/
â”œâ”€â”€ /settings      (3ä¸ªç»„ä»¶)
â”œâ”€â”€ /comparison    (2ä¸ªç»„ä»¶)
â”œâ”€â”€ /workbench     (4ä¸ªç»„ä»¶)
â””â”€â”€ å…¶ä»–34ä¸ªé¡¶å±‚ç»„ä»¶  âŒ åˆ†ç±»æ··ä¹±
```

å»ºè®®ç»“æ„ï¼š
```
src/components/
â”œâ”€â”€ /Material      (ææ–™ç›¸å…³ - 4ä¸ªç»„ä»¶)
â”œâ”€â”€ /Capacity      (äº§èƒ½ç›¸å…³ - 3ä¸ªç»„ä»¶)
â”œâ”€â”€ /Planning      (æ’äº§ç›¸å…³ - 5ä¸ªç»„ä»¶)
â”œâ”€â”€ /Risk          (é£é™©ç›¸å…³ - 4ä¸ªç»„ä»¶)
â””â”€â”€ /shared        (é€šç”¨ç»„ä»¶)
```

### 1.2 çŠ¶æ€ç®¡ç†é—®é¢˜

#### ğŸ—‚ï¸ Zustand Store åˆ†æ

**use-global-store.ts çŠ¶æ€ç²’åº¦æ··ä¹±**ï¼š

```typescript
export interface GlobalState {
  // âœ“ æ­£ç¡®ï¼šå…¨å±€åº”ç”¨çŠ¶æ€
  activeVersionId: string | null;

  // âœ“ æ­£ç¡®ï¼šç”¨æˆ·ä¿¡æ¯
  currentUser: string;

  // âš ï¸ é—®é¢˜ï¼šUIä¸´æ—¶çŠ¶æ€ä¸åº”åœ¨å…¨å±€store
  workbenchViewMode: WorkbenchViewMode;
  workbenchFilters: WorkbenchFilters;

  // âš ï¸ é—®é¢˜ï¼šç‰¹å®šåŠŸèƒ½çŠ¶æ€åº”ç‹¬ç«‹
  versionComparisonMode: VersionComparisonMode | null;
}
```

**é—®é¢˜**ï¼š
- æ··åˆäº†å…¨å±€çŠ¶æ€ã€UIçŠ¶æ€ã€ç”¨æˆ·è®¾ç½®ã€ç‰¹å®šåŠŸèƒ½çŠ¶æ€
- 16ä¸ªå¯¼å‡ºçš„ selector hooksï¼Œå¯¼è‡´ç»„ä»¶è¿‡åº¦è®¢é˜…
- æŒä¹…åŒ–ç­–ç•¥ä¸å½“ï¼ˆå·¥ä½œå°ç­›é€‰æ¡ä»¶ä¸åº”æŒä¹…åŒ–ï¼‰

#### ğŸ”„ ç»„ä»¶çŠ¶æ€ç®¡ç†æ··ä¹±

```typescript
// MaterialManagement.tsx - 10+ä¸ª useState
const [selectedRowKeys, setSelectedRowKeys] = useState<React.Key[]>([]);
const [selectedMaterial, setSelectedMaterial] = useState<Material | null>(null);
const [inspectorVisible, setInspectorVisible] = useState(false);
const [modalVisible, setModalVisible] = useState(false);
const [modalType, setModalType] = useState<'lock' | 'unlock' | ...>();
const [reason, setReason] = useState('');
// ... æ›´å¤š
```

**é—®é¢˜**ï¼šç›¸å…³çŠ¶æ€æ•£è½å„å¤„ï¼Œéš¾ä»¥ç»´æŠ¤ã€‚

### 1.3 ç±»å‹å®‰å…¨é—®é¢˜

#### ğŸš¨ `any` ç±»å‹æ»¥ç”¨ï¼ˆ20+å¤„ï¼‰

ä¸¥é‡æ€§åˆ†ç±»ï¼š

| ç±»å‹ | æ•°é‡ | ä¸¥é‡ç¨‹åº¦ | ä½ç½®ç¤ºä¾‹ |
|------|------|----------|----------|
| APIå“åº”å¼ºåˆ¶è½¬å‹ | 8+ | ğŸ”´ é«˜ | `(raw as any)?.master` |
| çª—å£å¯¹è±¡ç±»å‹ | 2 | ğŸŸ¡ ä¸­ | `(window as any).__TAURI__` |
| æ•°æ®è½¬æ¢ä¸´æ—¶è½¬å‹ | 5+ | ğŸŸ¡ ä¸­ | `(result as any).forEach` |
| UIç»„ä»¶props | 3+ | ğŸŸ¡ ä¸­ | `value={dateRange as any}` |

**å…·ä½“é—®é¢˜**ï¼š

```typescript
// âŒ StrategyDraftComparison.tsx - è¿è¡Œæ—¶é£é™©
const maybeMaster = (raw as any)?.master ??
                    (raw as any)?.material_master ??
                    (raw as any)?.[0];  // å¤šç§å¯èƒ½æ€§æœªéªŒè¯
```

**æ”¹è¿›æ–¹æ¡ˆ**ï¼šä½¿ç”¨ Zod Schema æˆ–ç±»å‹å®ˆå«å‡½æ•°ã€‚

### 1.4 ä»£ç é‡å¤é—®é¢˜

#### ğŸ” å‘ç°çš„é‡å¤æ¨¡å¼

**1. åŠ è½½æœºç»„é€‰é¡¹ï¼ˆé‡å¤2æ¬¡ï¼‰**

```typescript
// MaterialManagement.tsx:93
const loadMachineOptions = useCallback(async () => {
  const result = await materialApi.listMaterials({ limit: 0, offset: 0 });
  const codes = new Set<string>();
  (Array.isArray(result) ? result : []).forEach((m: any) => {
    const code = String(m?.machine_code ?? '').trim();
    if (code) codes.add(code);
  });
  setMachineOptions(Array.from(codes).sort().map(...));
});

// CapacityPoolManagement.tsx:71 - å®Œå…¨ç›¸åŒçš„é€»è¾‘
```

**2. APIè°ƒç”¨é”™è¯¯å¤„ç†ï¼ˆå¤šå¤„ä¸ä¸€è‡´ï¼‰**

```typescript
// æ¨¡å¼1
catch (error: any) {
  const msg = String(error?.message || error || 'åŠ è½½å¤±è´¥');
  message.error(`åŠ è½½å¤±è´¥: ${msg}`);
}

// æ¨¡å¼2
catch (error: any) {
  message.error(`åŠ è½½å¤±è´¥: ${error.message || error}`);
}

// æ¨¡å¼3ï¼ˆé™é»˜å¤±è´¥ï¼‰
.catch(() => void 0);  // âŒ å¿½ç•¥æ‰€æœ‰é”™è¯¯
```

### 1.5 æ€§èƒ½é—®é¢˜

#### âš¡ è¯†åˆ«çš„æ€§èƒ½ç“¶é¢ˆ

**1. è¿‡åº¦çš„å‰¯ä½œç”¨ç»‘å®š**

```typescript
// âŒ loadMachineOptions æ€»æ˜¯æ–°çš„ function
useEffect(() => {
  loadMachineOptions().catch(...);
}, [loadMachineOptions, preferredMachineCode]);
```

**2. ç¼ºå°‘ React.memo**

```typescript
// PlanManagement.tsx - æ¯æ¬¡æ¸²æŸ“éƒ½åˆ›å»ºæ–°æ•°ç»„
const unsatisfiedColumns: ColumnsType<OrderFailureRow> = [
  { title: 'ææ–™ID', ... },
  // ... 10+ åˆ—å®šä¹‰
];
// åº”è¯¥ç”¨ useMemo
```

**3. å¤§å‹ç»„ä»¶çš„å®Œæ•´é‡æ–°æ¸²æŸ“**

- PlanManagement (1904è¡Œ) æ¯ä¸ª setState è§¦å‘æ•´ä¸ªç»„ä»¶é‡æ–°æ¸²æŸ“

### 1.6 å‰ç«¯è¯„åˆ†è¯¦æƒ…

| ç»´åº¦ | è¯„åˆ† | è¯´æ˜ |
|------|------|------|
| ç»„ä»¶ç»“æ„ | 5/10 | å·¨å‹ç»„ä»¶ï¼ŒèŒè´£ä¸æ¸… |
| çŠ¶æ€ç®¡ç† | 6/10 | Zustandè‰¯å¥½ä½†è®¾è®¡æ··ä¹± |
| ç±»å‹å®‰å…¨ | 7/10 | æ•´ä½“è‰¯å¥½ï¼Œä½†æœ‰20+å¤„any |
| ä»£ç å¤ç”¨ | 5/10 | æ˜æ˜¾é‡å¤ä»£ç  |
| é”™è¯¯å¤„ç† | 4/10 | ä¸ä¸€è‡´ï¼Œå­˜åœ¨é™é»˜å¤±è´¥ |
| æ€§èƒ½ | 6/10 | æ— æ˜æ˜¾é™·é˜±ï¼Œæœ‰ä¼˜åŒ–ç©ºé—´ |
| å¯ç»´æŠ¤æ€§ | 5/10 | å¤§ç»„ä»¶éš¾ä»¥ç»´æŠ¤ |
| å¯è¯»æ€§ | 6/10 | æ³¨é‡Šå……åˆ†ï¼Œä½†é€»è¾‘å¤æ‚ |

**å‰ç«¯æ€»è¯„åˆ†**: **5.6/10** - åŠŸèƒ½å¯ç”¨ï¼Œä½†å­˜åœ¨æ˜æ˜¾çš„ç»“æ„å’Œè´¨é‡é—®é¢˜

---

## 2ï¸âƒ£ åç«¯ä»£ç è´¨é‡åˆ†æ

### 2.1 æ¶æ„è®¾è®¡è¯„ä¼°

#### ğŸ—ï¸ åˆ†å±‚æ¶æ„ âœ“ ä¼˜ç§€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  APIå±‚ (èšåˆ)                        â”‚  â† Tauri Commands
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Decisionå±‚ + Engineå±‚ (ä¸šåŠ¡è§„åˆ™)    â”‚  â† D1-D6å†³ç­– + 5å¼•æ“
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Repositoryå±‚ (æ•°æ®è®¿é—®)             â”‚  â† 11ä¸ªRepository
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Domainå±‚ (çº¯é¢†åŸŸæ¨¡å‹)               â”‚  â† 7ä¸ªå®ä½“
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¼˜ç‚¹**ï¼š
- âœ… å„å±‚èŒè´£æ˜ç¡®ï¼Œç¬¦åˆCLAUDE.mdè§„èŒƒ
- âœ… å•å‘ä¾èµ–ï¼Œæ— å¾ªç¯ä¾èµ–
- âœ… 111ä¸ªRepository public APIsï¼Œ88ä¸ªEngine public APIs
- âœ… mod.rs è®¾è®¡åˆç†ï¼Œæ¨¡å—å£°æ˜æ¸…æ™°

### 2.2 ä»£ç è´¨é‡è¯„ä¼°

#### âœ… é”™è¯¯å¤„ç† - ä¼˜ç§€

```rust
// src/api/error.rs - å®Œæ•´çš„å·¥ä¸šçº§é”™è¯¯ä½“ç³»
#[derive(Error, Debug)]
pub enum ApiError {
    #[error("å†»ç»“åŒºä¿æŠ¤: {0}")]
    FrozenZoneProtection(String),

    #[error("é€‚æ¸©çº¦æŸè¿å: material_id={material_id}...")]
    MaturityConstraintViolation {
        material_id: String,
        ready_in_days: i32
    },

    #[error("å·¥ä¸šçº¢çº¿è¿å: {0}")]
    RedLineViolation(String),
    // ... 18ä¸ªç‰¹å®šé”™è¯¯ç±»å‹
}
```

**ä¼˜ç‚¹**ï¼š
- âœ… åˆ†å±‚é”™è¯¯è½¬æ¢ï¼ˆRepositoryError â†’ ApiErrorï¼‰
- âœ… æ¯ä¸ªé”™è¯¯åŒ…å«ä¸šåŠ¡ä¸Šä¸‹æ–‡
- âœ… å·¥ä¸šçº¢çº¿åµŒå…¥é”™è¯¯ä½“ç³»ï¼ˆç¬¦åˆçº¢çº¿5ï¼‰

#### ğŸ”´ å…³é”®é—®é¢˜ï¼šä¸å®‰å…¨çš„é”å¤„ç†ï¼ˆ90å¤„ï¼‰

```rust
// âŒ src/app/state.rs:211
let c = conn.lock().unwrap();  // é”ä¸­æ¯’ä¼španic!

// âŒ src/api/config_api.rs:59
let conn = self.conn.lock().unwrap();

// âœ… åº”è¯¥æ”¹ä¸º
let c = conn.lock()
    .map_err(|e| RepositoryError::LockError(e.to_string()))?;
```

**é£é™©ç­‰çº§**ï¼šğŸ”´ **é«˜**
- å¦‚æœä»»ä½•çº¿ç¨‹åœ¨æŒæœ‰é”æ—¶panicï¼Œåç»­æ‰€æœ‰`.unwrap()`éƒ½ä¼šcrash
- ç”Ÿäº§ç¯å¢ƒä¸­å¯èƒ½å¯¼è‡´åº”ç”¨æ— æ³•æ¢å¤

#### âš ï¸ å¼‚æ­¥ä»£ç é—®é¢˜

```rust
// src/engine/importer.rs:85
pub async fn import_from_csv(&self, ...) -> Result<...> {
    let raw_records = self.parse_csv(file_path)?;  // âŒ åŒæ­¥æ“ä½œ
    // æ ‡è®°ä¸ºasyncä½†æ²¡æœ‰.awaitè°ƒç”¨
}
```

**é—®é¢˜**ï¼š
- åœ¨Tauriä¸­å¯èƒ½é˜»å¡UIçº¿ç¨‹
- åº”è¯¥ç”¨ `tokio::task::spawn_blocking`

#### âš ï¸ SQLæ„å»ºå™¨å®‰å…¨éšæ‚£

```rust
// src/decision/common/sql_builder.rs:55
pub fn build_optional_filter_sql(
    base_query: &str,
    additional_filter: Option<&str>,  // âŒ æ¥å—è£¸SQLç‰‡æ®µ
    order_by_clause: &str,
) -> String {
    if let Some(filter) = additional_filter {
        format!("{} AND {} ORDER BY {}", base_query, filter, order_by_clause)
        //                    ^^^^^^ ç›´æ¥æ‹¼æ¥
    }
}
```

**å½“å‰æƒ…å†µ**ï¼šå®é™…ä½¿ç”¨éƒ½æ˜¯ç¡¬ç¼–ç ï¼Œå®‰å…¨ âœ…
**å»ºè®®**ï¼šæ·»åŠ æ³¨é‡Š"ä»…ä¾›å†…éƒ¨ä½¿ç”¨"

### 2.3 å·¥ä¸šçº¢çº¿åˆè§„æ€§ âœ“ ä¼˜ç§€

#### çº¢çº¿æ£€æŸ¥æ¸…å•

| çº¢çº¿ | è¦æ±‚ | å®ç° | çŠ¶æ€ |
|------|------|------|------|
| **çº¢çº¿1** | å†»ç»“åŒºä¿æŠ¤ | `if state.sched_state == SchedState::Locked` | âœ… æ­£ç¡® |
| **çº¢çº¿2** | é€‚æ¸©çº¦æŸ | `ready_in_days: i32, earliest_sched_date` | âœ… æ­£ç¡® |
| **çº¢çº¿3** | åˆ†å±‚ç´§æ€¥ç­‰çº§ | `enum UrgentLevel { L0, L1, L2, L3 }` | âœ… ç±»å‹å¼ºåˆ¶ |
| **çº¢çº¿4** | äº§èƒ½ä¼˜å…ˆ | `if !capacity_pool.can_add_material(weight)` | âœ… æ­£ç¡® |
| **çº¢çº¿5** | å¯è§£é‡Šæ€§ | `violations: Vec<ValidationViolation>` | âœ… å®Œæ•´ |

### 2.4 æµ‹è¯•è¦†ç›–

| æŒ‡æ ‡ | æ•°é‡ |
|------|------|
| æµ‹è¯•æ–‡ä»¶ | 39ä¸ª |
| å•å…ƒæµ‹è¯• | 415ä¸ª |
| æµ‹è¯•ä»£ç è¡Œæ•° | 17,755è¡Œ |
| ä»£ç :æµ‹è¯•æ¯”ä¾‹ | 1:0.36 |

**è¯„ä»·**ï¼šâœ… æµ‹è¯•è¦†ç›–åº¦ä¸­ç­‰åé«˜

### 2.5 æ€§èƒ½å’Œæ‰©å±•æ€§

#### âš ï¸ å¹¶å‘ç“¶é¢ˆ

```rust
// src/repository/material_repo.rs:22
conn: Arc<Mutex<Connection>>,  // âš ï¸ å•ä¸ªMutex
```

**é—®é¢˜**ï¼š
- æ‰€æœ‰æ•°æ®åº“æ“ä½œäº‰æŠ¢åŒä¸€ä¸ªMutex
- é«˜å¹¶å‘ä¸‹å¯èƒ½æˆä¸ºç“¶é¢ˆ
- SQLiteçš„å¹¶å‘èƒ½åŠ›æœ‰é™

**å»ºè®®**ï¼šè¿ç§»åˆ° `sqlx` æˆ–ä½¿ç”¨è¿æ¥æ± 

### 2.6 åç«¯è¯„åˆ†è¯¦æƒ…

| ç»´åº¦ | è¯„åˆ† | è¯´æ˜ |
|------|------|------|
| æ¶æ„è®¾è®¡ | 9/10 | åˆ†å±‚æ¸…æ™°ï¼Œæ— å¾ªç¯ä¾èµ– |
| é”™è¯¯å¤„ç† | 9/10 | å®Œæ•´çš„é”™è¯¯ä½“ç³» |
| å¹¶å‘å®‰å…¨ | 5/10 | 90å¤„.lock().unwrap() |
| SQLå®‰å…¨ | 8/10 | 100%å‚æ•°åŒ–æŸ¥è¯¢ |
| ä¸šåŠ¡é€»è¾‘ | 9/10 | äº”å¤§å¼•æ“æ¸…æ™°åˆ†ç¦» |
| å·¥ä¸šåˆè§„ | 10/10 | çº¢çº¿å…¨è¦†ç›– |
| æµ‹è¯•è¦†ç›– | 8/10 | 415ä¸ªå•å…ƒæµ‹è¯• |
| å¯ç»´æŠ¤æ€§ | 8/10 | ä»£ç ç»„ç»‡è§„èŒƒ |

**åç«¯æ€»è¯„åˆ†**: **8.0/10** - æ¶æ„ä¼˜ç§€ï¼Œéœ€æ”¹è¿›å¹¶å‘å®‰å…¨

---

## 3ï¸âƒ£ APIå±‚ä¸€è‡´æ€§åˆ†æ

### 3.1 APIå®šä¹‰ä¸€è‡´æ€§

#### âœ“ å‘½åè§„èŒƒä¸€è‡´

```typescript
// å‰ç«¯ (tauri.ts)
async createPlan(planName: string, createdBy: string): Promise<string> {
  return IpcClient.call('create_plan', {
    plan_name: planName,  // âœ“ snake_case
    created_by: createdBy,
  });
}

// åç«¯ (tauri_commands.rs)
#[tauri::command(rename_all = "snake_case")]
pub async fn create_plan(
  plan_name: String,
  created_by: String,
) -> Result<String, String>
```

#### âš ï¸ é‡å¤çš„APIæ¥å£

**å‘ç°6å¯¹é‡å¤å®šä¹‰**ï¼š

```rust
// âŒ åŸºç¡€ç‰ˆæœ¬
pub fn get_most_risky_date(&self, version_id: &str) -> ApiResult<...>

// âŒ "Full"ç‰ˆæœ¬ï¼ˆå®Œæ•´å‚æ•°ï¼‰
pub fn get_most_risky_date_full(
    &self,
    version_id: &str,
    date_from: Option<&str>,
    date_to: Option<&str>,
    risk_level_filter: Option<Vec<String>>,
    limit: Option<u32>,
) -> ApiResult<...>
```

**é‡å¤åˆ—è¡¨**ï¼š
1. `get_most_risky_date` / `get_most_risky_date_full`
2. `get_unsatisfied_urgent_materials` / `get_unsatisfied_urgent_materials_full`
3. `get_cold_stock_materials` / `get_cold_stock_materials_full`
4. `get_most_congested_machine` / `get_most_congested_machine_full`
5. ä»¥åŠ Tauri å‘½ä»¤å±‚çš„ç±»ä¼¼é‡å¤

**é—®é¢˜**ï¼š
- ç»´æŠ¤æˆæœ¬é«˜
- è°ƒç”¨æ—¶éœ€è¦é€‰æ‹©ç‰ˆæœ¬
- è¿å"å•ä¸€å…¥å£"åŸåˆ™

### 3.2 ç±»å‹å®‰å…¨é—®é¢˜

#### âš ï¸ Zod Schemaè¦†ç›–ä¸è¶³

âœ“ **å·²éªŒè¯çš„API**ï¼ˆçº¦10ä¸ªï¼‰ï¼š
- `GenerateStrategyDraftsResponse`
- `ListStrategyDraftsResponse`
- `DecisionRefreshStatusResponse`

âœ— **ç¼ºå°‘éªŒè¯çš„API**ï¼ˆçº¦40+ä¸ªï¼‰ï¼š
- `list_materials` - æ— è¿”å›ç±»å‹å®šä¹‰
- `list_plan_items` - æ— è¿”å›ç±»å‹å®šä¹‰
- `get_risk_snapshot` - æ— è¿”å›ç±»å‹å®šä¹‰
- Decision API (D1-D6) å‡ ä¹å…¨éƒ¨ç¼ºå¤±

**é—®é¢˜ä»£ç **ï¼š

```typescript
// âŒ æ— éªŒè¯ï¼Œanyç±»å‹
async getColdStockMaterials(versionId: string): Promise<any> {
  return IpcClient.call('get_cold_stock_materials', { version_id: versionId });
}
```

**æ”¹è¿›å»ºè®®**ï¼šä¸ºæ‰€æœ‰Responseæ·»åŠ Zod Schema

### 3.3 é”™è¯¯å¤„ç†é—®é¢˜

#### âš ï¸ é”™è¯¯ä»£ç æœªç±»å‹åŒ–

```typescript
// âŒ é”™è¯¯ä»£ç æ˜¯å­—ç¬¦ä¸²å­—é¢é‡
if (error.code === 'FROZEN_ZONE_PROTECTION') { }

// âœ… åº”è¯¥ä½¿ç”¨æšä¸¾
enum IpcErrorCode {
  FROZEN_ZONE_PROTECTION = 'FROZEN_ZONE_PROTECTION',
  MATURITY_CONSTRAINT_VIOLATION = 'MATURITY_CONSTRAINT_VIOLATION',
  // ...
}
```

#### âš ï¸ é‡è¯•æœºåˆ¶ä¸å®Œå–„

```typescript
// src/api/ipcClient.tsx
private static isRetryable(error: IpcError): boolean {
  return ['Timeout', 'NetworkError'].includes(error.code);
  // âŒ ç¼ºå°‘ DATABASE_CONNECTION_ERROR ç­‰å¯é‡è¯•é”™è¯¯
}
```

### 3.4 APIè®¾è®¡é—®é¢˜

#### âš ï¸ å‚æ•°åºåˆ—åŒ–ä¸ä¸€è‡´

```typescript
// æœ‰äº›å‚æ•°å¯ä»¥ç›´æ¥ä¼ é€’æ•°ç»„
strategies: Vec<String>  // âœ“ Tauriè‡ªåŠ¨å¤„ç†

// æœ‰äº›å¿…é¡»æ‰‹åŠ¨ JSON.stringify
moves: JSON.stringify([...])  // âŒ å¿…é¡»åºåˆ—åŒ–
```

#### âš ï¸ APIç²’åº¦é—®é¢˜

```rust
// å¼ºåˆ¶è¦æ±‚æ‰€æœ‰å‚æ•°
pub async fn get_capacity_pools(
    machine_codes: String,  // å¿…éœ€
    date_from: String,      // å¿…éœ€
    date_to: String,        // å¿…éœ€
) -> Result<String, String>
```

**é—®é¢˜**ï¼šä¸èƒ½æŸ¥è¯¢æ‰€æœ‰æœºç»„æˆ–æ‰€æœ‰æ—¥æœŸ

### 3.5 æ€§èƒ½é—®é¢˜

#### ğŸ”´ åˆ—è¡¨æŸ¥è¯¢ç¼ºå°‘åˆç†çš„åˆ†é¡µ

```typescript
// CapacityPoolManagement.tsx
const result = await materialApi.listMaterials({
  limit: 0,  // âŒ è¿”å›æ‰€æœ‰è®°å½•ï¼
  offset: 0
});
```

**é£é™©**ï¼š10,000æ¡è®°å½•ä¼šå¯¼è‡´å†…å­˜æº¢å‡ºå’Œç½‘ç»œè¶…æ—¶

#### âš ï¸ N+1æŸ¥è¯¢é—®é¢˜

```typescript
// ç¬¬ä¸€æ¬¡è¯·æ±‚ï¼šè·å–æ‰€æœ‰ææ–™ä»¥æå–æœºç»„ä»£ç 
const result = await materialApi.listMaterials({ limit: 0 });

// ç¬¬äºŒæ¬¡è¯·æ±‚ï¼šè·å–äº§èƒ½æ± 
const pools = await capacityApi.getCapacityPools(...);
```

**æ”¹è¿›**ï¼šåº”è¯¥æœ‰ä¸“ç”¨çš„ `listMachines()` API

### 3.6 APIå±‚è¯„åˆ†è¯¦æƒ…

| ç»´åº¦ | è¯„åˆ† | è¯´æ˜ |
|------|------|------|
| å‘½åä¸€è‡´æ€§ | 8/10 | snake_caseæ­£ç¡®æ˜ å°„ |
| æ¥å£è®¾è®¡ | 5/10 | å­˜åœ¨6å¯¹é‡å¤å®šä¹‰ |
| ç±»å‹å®‰å…¨ | 5/10 | 40+ä¸ªAPIç¼ºå°‘éªŒè¯ |
| é”™è¯¯å¤„ç† | 6/10 | é”™è¯¯ä»£ç æœªç±»å‹åŒ– |
| æ€§èƒ½ | 5/10 | N+1æŸ¥è¯¢ï¼Œlimit:0é£é™© |
| å¯è¿½æº¯æ€§ | 9/10 | å®Œæ•´çš„æ“ä½œæ—¥å¿— |

**APIå±‚æ€»è¯„åˆ†**: **6.5/10** - åŸºæœ¬å¯ç”¨ï¼Œéœ€æ”¹è¿›è®¾è®¡å’Œç±»å‹å®‰å…¨

---

## 4ï¸âƒ£ æ¨¡å—è€¦åˆåº¦è¯„ä¼°

### 4.1 å‰ç«¯ç»„ä»¶è€¦åˆ

#### ğŸ”´ é«˜åº¦è€¦åˆçš„ç»„ä»¶

**PlanManagement.tsx ä¾èµ–åˆ†æ**ï¼š

```typescript
import { planApi, capacityApi } from '../api/tauri';  // APIå±‚
import { useGlobalStore } from '../stores/use-global-store';  // çŠ¶æ€å±‚
import { useNavigate } from 'react-router-dom';  // è·¯ç”±å±‚
import { useQuery } from '@tanstack/react-query';  // æ•°æ®å±‚
import { exportCSV, exportJSON, exportHTML } from '../utils/exportUtils';  // å·¥å…·å±‚
// ... 20+ ä¸ªå¯¼å…¥
```

**è€¦åˆé—®é¢˜**ï¼š
- âœ— ç›´æ¥ä¾èµ– APIã€storeã€utilsã€router
- âœ— ç¼ºå°‘ä¸­é—´å±‚æŠ½è±¡
- âœ— éš¾ä»¥å•å…ƒæµ‹è¯•

#### ğŸ“Š çŠ¶æ€è€¦åˆ

**å½“å‰æ•°æ®æµ**ï¼š

```
API â”€â”€â†’ Component State â”€â”€â†’ Zustand Store â”€â”€â†’ Other Components
       (useState)           (useGlobalStore)
```

**é—®é¢˜**ï¼š
- åŒä¸€æ•°æ®åœ¨å¤šä¸ªåœ°æ–¹å­˜å‚¨
- åŒæ­¥æœºåˆ¶ä¸æ¸…æ™°ï¼ˆevent bus + store + useStateæ··ç”¨ï¼‰
- ç¼“å­˜ç­–ç•¥ä¸ä¸€è‡´

#### ğŸ”„ åŒå‘ä¾èµ–

```
MaterialManagement.tsx
  â†” CapacityTimeline.tsx  âŒ åŒå‘ä¾èµ–
```

### 4.2 åç«¯æ¨¡å—è€¦åˆ

#### âœ… æ¸…æ™°çš„å•å‘ä¾èµ–

```
APIå±‚ (èšåˆ)
  â†“
Decisionå±‚ + Engineå±‚ (ä¸šåŠ¡è§„åˆ™)
  â†“
Repositoryå±‚ (æ•°æ®è®¿é—®)
  â†“
Domainå±‚ (çº¯é¢†åŸŸæ¨¡å‹)
```

**ä¼˜ç‚¹**ï¼š
- âœ… Repositoryå±‚ï¼šä»…ä¾èµ–domain + error
- âœ… Engineå±‚ï¼šä¾èµ–domain + repository + config
- âœ… Decisionå±‚ï¼šä¾èµ–engine + repository + models
- âœ… æ— å¾ªç¯ä¾èµ–

#### âš ï¸ AppStateä½œä¸ºä¾èµ–æ³¨å…¥å®¹å™¨

```rust
pub struct AppState {
    pub material_api: Arc<MaterialApi>,
    pub plan_api: Arc<PlanApi>,
    pub dashboard_api: Arc<DashboardApi>,
    // ... 15+ ä¸ªArc<...>
}
```

**è¯„ä»·**ï¼šâœ… è¿™ç§æ¨¡å¼å¯¹Tauriåº”ç”¨æ˜¯å¿…è¦çš„ï¼Œè®¾è®¡åˆç†

### 4.3 å‰åç«¯è€¦åˆ

#### ğŸ”Œ IPCé€šä¿¡å±‚

```
å‰ç«¯ IpcClient â”€â”€â”€â”€â”€IPC Callâ”€â”€â”€â”€â†’ Tauri Commands â”€â”€â”€â”€â†’ AppState â”€â”€â”€â”€â†’ APIå®ç°
                     (JSON)                             (ä¾èµ–æ³¨å…¥)
```

**ä¼˜ç‚¹**ï¼š
- âœ… é€šè¿‡IPCéš”ç¦»å‰åç«¯
- âœ… JSONåºåˆ—åŒ–/ååºåˆ—åŒ–è‡ªåŠ¨å¤„ç†
- âœ… é”™è¯¯ç»Ÿä¸€æ˜ å°„

**é—®é¢˜**ï¼š
- âš ï¸ ç±»å‹å®šä¹‰æœªåœ¨å‰åç«¯å…±äº«
- âš ï¸ éœ€è¦æ‰‹åŠ¨ä¿æŒåŒæ­¥

### 4.4 æ¨¡å—è€¦åˆåº¦è¯„åˆ†

| ç»´åº¦ | è¯„åˆ† | è¯´æ˜ |
|------|------|------|
| å‰ç«¯ç»„ä»¶è€¦åˆ | 4/10 | é«˜åº¦è€¦åˆï¼Œç¼ºå°‘åˆ†å±‚ |
| å‰ç«¯çŠ¶æ€è€¦åˆ | 5/10 | å¤šç§çŠ¶æ€æºæ··ç”¨ |
| åç«¯æ¨¡å—è€¦åˆ | 9/10 | æ¸…æ™°çš„å•å‘ä¾èµ– |
| å‰åç«¯è€¦åˆ | 7/10 | IPCéš”ç¦»è‰¯å¥½ |
| æ•°æ®æµæ¸…æ™°åº¦ | 5/10 | å‰ç«¯æ··ä¹±ï¼Œåç«¯æ¸…æ™° |

**æ¨¡å—è€¦åˆåº¦æ€»è¯„åˆ†**: **6.0/10** - åç«¯ä¼˜ç§€ï¼Œå‰ç«¯éœ€æ”¹è¿›

---

## 5ï¸âƒ£ å…³é”®é—®é¢˜æ±‡æ€»è¡¨

### ğŸ”´ P0 - å¿…é¡»ç«‹å³ä¿®å¤ï¼ˆå½±å“ç”Ÿäº§ç¨³å®šæ€§ï¼‰

| # | é—®é¢˜ | ä½ç½® | å½±å“ | å·¥ä½œé‡ |
|---|------|------|------|--------|
| 1 | 90å¤„`.lock().unwrap()`å¯¼è‡´panic | åç«¯å¤šå¤„ | ğŸ”´ åº”ç”¨crash | 2å°æ—¶ |
| 2 | `listMaterials(limit: 0)`åŠ è½½æ‰€æœ‰æ•°æ® | å‰ç«¯å¤šå¤„ | ğŸ”´ å†…å­˜æº¢å‡º | 30åˆ†é’Ÿ |

### ğŸŸ¡ P1 - é‡è¦ï¼ˆå½±å“ä»£ç è´¨é‡å’Œå¯ç»´æŠ¤æ€§ï¼‰

| # | é—®é¢˜ | ä½ç½® | å½±å“ | å·¥ä½œé‡ |
|---|------|------|------|--------|
| 3 | å·¨å‹ç»„ä»¶ï¼ˆ1000+è¡Œï¼‰ | PlanManagementç­‰ | ğŸŸ¡ éš¾ä»¥ç»´æŠ¤ | 2å‘¨ |
| 4 | 20+å¤„`any`ç±»å‹æ»¥ç”¨ | å‰ç«¯å¤šå¤„ | ğŸŸ¡ è¿è¡Œæ—¶é”™è¯¯ | 3-5å¤© |
| 5 | 6å¯¹é‡å¤çš„APIæ¥å£ | dashboard_api.rs | ğŸŸ¡ ç»´æŠ¤å›°éš¾ | 2å¤© |
| 6 | 40+ä¸ªAPIç¼ºå°‘ç±»å‹éªŒè¯ | ipcSchemas.ts | ğŸŸ¡ ç±»å‹ä¸å®‰å…¨ | 1å‘¨ |
| 7 | å¼‚æ­¥å‡½æ•°æ ‡è®°ä½†åŒæ­¥æ‰§è¡Œ | importer.rs | ğŸŸ¡ UIé˜»å¡ | 1å¤© |

### ğŸŸ¢ P2 - ä¼˜åŒ–ï¼ˆæå‡æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒï¼‰

| # | é—®é¢˜ | ä½ç½® | å½±å“ | å·¥ä½œé‡ |
|---|------|------|------|--------|
| 8 | é‡å¤ä»£ç æ¨¡å¼ | å‰ç«¯å¤šå¤„ | ğŸŸ¢ ä»£ç å†—ä½™ | 3-5å¤© |
| 9 | ä¸ä¸€è‡´çš„é”™è¯¯å¤„ç† | å‰ç«¯å¤šå¤„ | ğŸŸ¢ ç”¨æˆ·ä½“éªŒ | 2-3å¤© |
| 10 | å•Mutexæ•°æ®åº“è¿æ¥ | repositoryå±‚ | ğŸŸ¢ å¹¶å‘ç“¶é¢ˆ | 1å‘¨ |
| 11 | N+1æŸ¥è¯¢é—®é¢˜ | å‰ç«¯APIè°ƒç”¨ | ğŸŸ¢ æ€§èƒ½é—®é¢˜ | 2å¤© |
| 12 | çŠ¶æ€ç®¡ç†ç²’åº¦æ··ä¹± | use-global-store.ts | ğŸŸ¢ é‡æ–°æ¸²æŸ“ | 1å‘¨ |

---

## 6ï¸âƒ£ ä¼˜åŒ–å»ºè®®æ–¹æ¡ˆ

### ğŸ¯ Phase 1: ç´§æ€¥ä¿®å¤ï¼ˆ1å‘¨å†…ï¼‰

#### 1.1 ä¿®å¤å¹¶å‘å®‰å…¨é—®é¢˜ï¼ˆP0ï¼‰

```rust
// âŒ å½“å‰ä»£ç 
let conn = self.conn.lock().unwrap();

// âœ… æ”¹è¿›å
let conn = self.conn.lock()
    .map_err(|e| RepositoryError::LockError(e.to_string()))?;
```

**å½±å“èŒƒå›´**ï¼š90å¤„
**é¢„è®¡å·¥ä½œé‡**ï¼š2å°æ—¶
**ä¼˜å…ˆçº§**ï¼šğŸ”´ **æœ€é«˜**

#### 1.2 ä¿®å¤åˆ†é¡µæŸ¥è¯¢ï¼ˆP0ï¼‰

```typescript
// âŒ å½“å‰ä»£ç 
const result = await materialApi.listMaterials({ limit: 0, offset: 0 });

// âœ… æ”¹è¿›å
const result = await materialApi.listMaterials({ limit: 100, offset: 0 });
// æˆ–åˆ›å»ºä¸“ç”¨API
const machineList = await materialApi.listMachines();
```

**å½±å“èŒƒå›´**ï¼š3å¤„
**é¢„è®¡å·¥ä½œé‡**ï¼š30åˆ†é’Ÿ
**ä¼˜å…ˆçº§**ï¼šğŸ”´ **é«˜**

### ğŸ¯ Phase 2: æ¶æ„é‡æ„ï¼ˆ2-4å‘¨ï¼‰

#### 2.1 åˆ†è§£å·¨å‹ç»„ä»¶

**PlanManagement.tsx åˆ†è§£æ–¹æ¡ˆ**ï¼š

```
PlanManagement (å®¹å™¨ - 200è¡Œ)
â”œâ”€ PlanListView (åˆ—è¡¨å±•ç¤º - 300è¡Œ)
â”œâ”€ VersionComparisonView (å¯¹æ¯”å®¹å™¨ - 400è¡Œ)
â”‚  â”œâ”€ DiffSummary (æ‘˜è¦ - 100è¡Œ)
â”‚  â”œâ”€ ItemDiffTable (å·®å¼‚è¡¨ - 200è¡Œ)
â”‚  â””â”€ CapacityDeltaChart (å›¾è¡¨ - 150è¡Œ)
â”œâ”€ PlanExportActions (å¯¼å‡º - 150è¡Œ)
â””â”€ PlanDetailDrawer (è¯¦æƒ… - 300è¡Œ)
```

**é¢„è®¡å·¥ä½œé‡**ï¼š2å‘¨
**ä¼˜å…ˆçº§**ï¼šğŸŸ¡ **ä¸­**

#### 2.2 è¡¥å…¨ç±»å‹å®‰å…¨

```typescript
// ä¸ºæ‰€æœ‰Responseæ·»åŠ Zod Schema
export const ListMaterialsResponseSchema = z.array(
  z.object({
    material_id: z.string(),
    machine_code: z.string().nullable(),
    weight_t: z.number().nullable(),
    sched_state: z.string(),
    urgent_level: z.string(),
    // ...
  })
);

// åœ¨IpcClientä¸­éªŒè¯
const validated = ListMaterialsResponseSchema.parse(result);
```

**é¢„è®¡å·¥ä½œé‡**ï¼š1å‘¨
**ä¼˜å…ˆçº§**ï¼šğŸŸ¡ **ä¸­é«˜**

#### 2.3 é‡æ„çŠ¶æ€ç®¡ç†

**åˆ†ç¦»å…¨å±€çŠ¶æ€å’ŒUIçŠ¶æ€**ï¼š

```typescript
// å…¨å±€çŠ¶æ€ï¼ˆæŒä¹…åŒ–ï¼‰
interface GlobalAppState {
  activeVersionId: string | null;
  currentUser: string;
  adminOverrideMode: boolean;
}

// UIçŠ¶æ€ï¼ˆä¸æŒä¹…åŒ–ï¼‰
interface UIState {
  workbenchViewMode: WorkbenchViewMode;
  workbenchFilters: WorkbenchFilters;
}

// åˆ†ç¦»ä¸ºä¸¤ä¸ªstore
export const useGlobalAppStore = create<GlobalAppState>(...);
export const useUIStore = create<UIState>(...);
```

**é¢„è®¡å·¥ä½œé‡**ï¼š1å‘¨
**ä¼˜å…ˆçº§**ï¼šğŸŸ¢ **ä½**

#### 2.4 æ¶ˆé™¤é‡å¤API

```rust
// âŒ åˆ é™¤æ‰€æœ‰ "_full" ç‰ˆæœ¬
pub fn get_most_risky_date_full(...) { }

// âœ… ä¿ç•™å•ä¸€æ¥å£ï¼Œä½¿ç”¨å¯é€‰å‚æ•°
pub fn get_most_risky_date(
    &self,
    version_id: &str,
    date_from: Option<&str>,
    date_to: Option<&str>,
    risk_level_filter: Option<Vec<String>>,
    limit: Option<u32>,
) -> ApiResult<DecisionDaySummaryResponse>
```

**é¢„è®¡å·¥ä½œé‡**ï¼š2å¤©
**ä¼˜å…ˆçº§**ï¼šğŸŸ¡ **ä¸­**

### ğŸ¯ Phase 3: æ€§èƒ½ä¼˜åŒ–ï¼ˆ1-2å‘¨ï¼‰

#### 3.1 æ•°æ®åº“è¿æ¥æ± 

```rust
// ä»å•Mutexè¿ç§»åˆ°è¿æ¥æ± 
// ä½¿ç”¨ r2d2-sqlite æˆ– sqlx
pub struct MaterialRepository {
    pool: Arc<Pool<ConnectionManager<Connection>>>,
}
```

**é¢„è®¡å·¥ä½œé‡**ï¼š1å‘¨
**ä¼˜å…ˆçº§**ï¼šğŸŸ¢ **ä½**

#### 3.2 ç»„ä»¶æ€§èƒ½ä¼˜åŒ–

```typescript
// æ·»åŠ  React.memo
export const PlanListView = React.memo(({ plans, onSelect }) => {
  // ...
});

// ä½¿ç”¨ useMemo ç¼“å­˜è®¡ç®—
const columns = useMemo(() => [
  { title: 'ææ–™ID', ... },
  // ...
], []);

// ä¼˜åŒ– useEffect ä¾èµ–
useEffect(() => {
  loadData();
}, [activeVersionId]);  // ç§»é™¤ loadData ä¾èµ–
```

**é¢„è®¡å·¥ä½œé‡**ï¼š3-5å¤©
**ä¼˜å…ˆçº§**ï¼šğŸŸ¢ **ä½**

---

## 7ï¸âƒ£ æ”¹è¿›è·¯çº¿å›¾

### Timeline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Week 1     â”‚  Week 2-3   â”‚  Week 4-5   â”‚  Week 6-7   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Phase 1:    â”‚ Phase 2:    â”‚ Phase 2:    â”‚ Phase 3:    â”‚
â”‚ ç´§æ€¥ä¿®å¤     â”‚ å‰ç«¯é‡æ„     â”‚ APIä¼˜åŒ–     â”‚ æ€§èƒ½ä¼˜åŒ–     â”‚
â”‚             â”‚             â”‚             â”‚             â”‚
â”‚ â€¢ é”å¤„ç†     â”‚ â€¢ åˆ†è§£ç»„ä»¶   â”‚ â€¢ æ¶ˆé™¤é‡å¤   â”‚ â€¢ è¿æ¥æ±      â”‚
â”‚ â€¢ åˆ†é¡µä¿®å¤   â”‚ â€¢ ç±»å‹å®‰å…¨   â”‚ â€¢ ç»Ÿä¸€é”™è¯¯   â”‚ â€¢ Reactä¼˜åŒ– â”‚
â”‚             â”‚ â€¢ çŠ¶æ€ç®¡ç†   â”‚             â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### é¢„æœŸæˆæœ

| Phase | é¢„æœŸæ”¹è¿› | è¯„åˆ†æå‡ |
|-------|---------|---------|
| Phase 1 | ç¨³å®šæ€§æå‡ï¼Œæ¶ˆé™¤crashé£é™© | åç«¯ 8.0â†’8.5 |
| Phase 2 | å‰ç«¯å¯ç»´æŠ¤æ€§æ˜¾è‘—æå‡ | å‰ç«¯ 5.6â†’7.0 |
| Phase 3 | æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒä¼˜åŒ– | å‰ç«¯ 7.0â†’7.5 |

### æœ€ç»ˆç›®æ ‡è¯„åˆ†

| ç»´åº¦ | å½“å‰ | ç›®æ ‡ |
|------|------|------|
| å‰ç«¯ä»£ç è´¨é‡ | 5.6/10 | 7.5/10 |
| åç«¯ä»£ç è´¨é‡ | 8.0/10 | 9.0/10 |
| APIå±‚ä¸€è‡´æ€§ | 6.5/10 | 8.0/10 |
| æ¨¡å—è€¦åˆåº¦ | 6.0/10 | 7.5/10 |
| **ç»¼åˆè¯„åˆ†** | **7.0/10** | **8.0/10** |

---

## 8ï¸âƒ£ ç»“è®ºä¸å»ºè®®

### æ€»ä½“è¯„ä»·

è¿™æ˜¯ä¸€ä¸ª**åŠŸèƒ½å®Œæ•´ã€å·¥ä¸šåˆè§„æ€§ä¼˜ç§€**çš„å†³ç­–æ”¯æŒç³»ç»Ÿã€‚åç«¯æ¶æ„æ¸…æ™°ã€æµ‹è¯•å……åˆ†ï¼Œå‰ç«¯åŠŸèƒ½ä¸°å¯Œä½†å­˜åœ¨æŠ€æœ¯å€ºã€‚

#### ğŸ–ï¸ æ ¸å¿ƒä¼˜åŠ¿

1. **å·¥ä¸šçº¢çº¿å®Œæ•´å®ç°** - ç¬¦åˆCLAUDE.mdè§„èŒƒï¼Œ5å¤§çº¢çº¿å…¨è¦†ç›–
2. **åç«¯æ¶æ„ä¼˜ç§€** - åˆ†å±‚æ¸…æ™°ï¼Œæ— å¾ªç¯ä¾èµ–ï¼Œä»£ç ç»„ç»‡è§„èŒƒ
3. **é”™è¯¯å¤„ç†å®Œå–„** - 18ç§ç‰¹å®šé”™è¯¯ç±»å‹ï¼Œå®Œæ•´çš„é”™è¯¯é“¾
4. **æµ‹è¯•è¦†ç›–å……åˆ†** - 415ä¸ªå•å…ƒæµ‹è¯•ï¼Œ17,755è¡Œæµ‹è¯•ä»£ç 
5. **ä¸šåŠ¡é€»è¾‘æ¸…æ™°** - äº”å¤§å¼•æ“å„å¸å…¶èŒï¼Œå†³ç­–å±‚ä¸ä¸šåŠ¡å¯¹é½

#### âš ï¸ ä¸»è¦æŒ‘æˆ˜

1. **å‰ç«¯ç»„ä»¶ç²’åº¦è¿‡å¤§** - å½±å“å¯ç»´æŠ¤æ€§å’Œå¯å¤ç”¨æ€§
2. **å¹¶å‘å®‰å…¨éšæ‚£** - 90å¤„`.lock().unwrap()`å­˜åœ¨crashé£é™©
3. **ç±»å‹å®‰å…¨ä¸è¶³** - å‰ç«¯20+å¤„`any`ï¼ŒAPIå±‚ç¼ºå°‘éªŒè¯
4. **APIè®¾è®¡å†—ä½™** - 6å¯¹é‡å¤æ¥å£ï¼Œç»´æŠ¤æˆæœ¬é«˜
5. **çŠ¶æ€ç®¡ç†æ··ä¹±** - å¤šç§çŠ¶æ€æºï¼Œæ•°æ®æµä¸æ¸…æ™°

### è¡ŒåŠ¨å»ºè®®

#### ğŸ”¥ ç«‹å³è¡ŒåŠ¨ï¼ˆæœ¬å‘¨ï¼‰

1. **ä¿®å¤90å¤„`.lock().unwrap()`** - é˜²æ­¢ç”Ÿäº§crash
2. **ä¿®å¤`limit: 0`æŸ¥è¯¢** - é˜²æ­¢å†…å­˜æº¢å‡º
3. **å®¡æŸ¥SQLæ„å»ºå™¨** - ç¡®è®¤å®‰å…¨æ€§

#### ğŸ“‹ çŸ­æœŸè®¡åˆ’ï¼ˆ1ä¸ªæœˆï¼‰

1. **åˆ†è§£3ä¸ªå·¨å‹ç»„ä»¶** - PlanManagement, StrategyDraftComparison, DrilldownDrawer
2. **è¡¥å…¨APIç±»å‹éªŒè¯** - ä¸º40+ä¸ªAPIæ·»åŠ Zod Schema
3. **æ¶ˆé™¤6å¯¹é‡å¤API** - ç»Ÿä¸€ä¸ºå•ä¸€æ¥å£
4. **æ ‡å‡†åŒ–é”™è¯¯å¤„ç†** - åˆ›å»ºç»Ÿä¸€çš„é”™è¯¯å¤„ç†å·¥å…·

#### ğŸ¯ é•¿æœŸè§„åˆ’ï¼ˆ3ä¸ªæœˆï¼‰

1. **é‡æ„å‰ç«¯çŠ¶æ€ç®¡ç†** - åˆ†ç¦»å…¨å±€/UIçŠ¶æ€
2. **è¿ç§»åˆ°æ•°æ®åº“è¿æ¥æ± ** - æå‡å¹¶å‘æ€§èƒ½
3. **å»ºç«‹ç»„ä»¶åº“** - æå–å¯å¤ç”¨ç»„ä»¶
4. **å®Œå–„æ–‡æ¡£** - æ·»åŠ æ¶æ„æ–‡æ¡£å’ŒAPIæ–‡æ¡£

### æœ€åçš„è¯

è¯¥é¡¹ç›®å±•ç°äº†**å·¥ä¸šçº§è½¯ä»¶çš„è§„èŒƒæ€§å’Œä¸¥è°¨æ€§**ï¼Œå°¤å…¶æ˜¯åç«¯çš„æ¶æ„è®¾è®¡å’Œå·¥ä¸šçº¢çº¿å®ç°å€¼å¾—ç§°èµã€‚é€šè¿‡ç³»ç»Ÿæ€§çš„é‡æ„å’Œä¼˜åŒ–ï¼Œå¯ä»¥è¿›ä¸€æ­¥æå‡ä»£ç è´¨é‡å’Œå›¢é˜Ÿç”Ÿäº§åŠ›ã€‚

å»ºè®®æŒ‰ç…§**P0 â†’ P1 â†’ P2**çš„ä¼˜å…ˆçº§é€æ­¥æ”¹è¿›ï¼Œé‡ç‚¹å…³æ³¨å¹¶å‘å®‰å…¨å’Œå‰ç«¯æ¶æ„é‡æ„ã€‚é¢„è®¡ç»è¿‡6-8å‘¨çš„åŠªåŠ›ï¼Œç³»ç»Ÿç»¼åˆè¯„åˆ†å¯ä»**7.0/10**æå‡è‡³**8.0/10**ä»¥ä¸Šã€‚

---

**æŠ¥å‘Šç”Ÿæˆ**: 2026-01-29
**è¯„ä¼°äºº**: Claude Code (Opus 4.5)
**ä¸‹æ¬¡è¯„ä¼°å»ºè®®**: 2ä¸ªæœˆåè¿›è¡Œå¢é‡è¯„ä¼°

